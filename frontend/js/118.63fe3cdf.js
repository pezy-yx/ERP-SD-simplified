"use strict";(self["webpackChunksite"]=self["webpackChunksite"]||[]).push([[118],{5118:function(e,t,a){a.r(t),a.d(t,{default:function(){return ne}});a(4114),a(8111),a(2489),a(7588),a(1701);var n=a(5796),l=a(7998),o=a(5691),s=a(1750),c=a(2697),r=a(2306);const u={class:"total"},i={id:"generalInfo"},d={id:"bankData"},v={id:"openItemSelection"},m={style:{display:"flex","justify-content":"space-between","align-items":"center",padding:"10px"}},p={style:{display:"flex","justify-content":"flex-end"}},k={style:{"font-weight":"bold"}},y={key:0,class:"query-results-list",style:{width:"100%"}},f={class:"material-document-rows-container"},h=["onClick"],L={class:"row-item checkbox-cell"},g=["onUpdate:modelValue"],b={class:"row-item company-code"},E={class:"row-item account"},C={class:"row-item journal-entry"},w={class:"row-item journal-entry-type"},D={class:"row-item journal-entry-date"},A={class:"row-item net-due-date"},R={class:"row-item amount"},I={class:"row-item assignment"},P={key:1,class:"query-results-list",style:{width:"100%","text-align":"center",padding:"20px"}},V={class:"table-footer-bar"},_={class:"select-all-checkbox"},S=["disabled"],x={class:"selected-items-count"},j={key:2,class:"query-results-list",style:{width:"100%"}},M={class:"material-document-rows-container"},K=["onClick"],N={class:"row-item checkbox-cell"},T=["onUpdate:modelValue"],U={class:"row-item company-code"},X={class:"row-item account"},W={class:"row-item journal-entry"},G={class:"row-item journal-entry-type"},J={class:"row-item journal-entry-date"},B={class:"row-item net-due-date"},F={class:"row-item amount"},O={class:"row-item assignment"},$={key:3,class:"query-results-list",style:{width:"100%","text-align":"center",padding:"20px"}},Z={class:"table-footer-bar"},H={class:"select-all-checkbox"},q=["disabled"],z={class:"selected-items-count"},Q={key:4,class:"modal-overlay"},Y={class:"modal-content"};var ee=(0,n.pM)({__name:"postingIncomingPayments",setup(e){const t=["AA(Asset Posting)","AB(Accounting Document)","AF(Depreciation Pstngs)","AN(Net Asset Posting)","AP","CG","CH(Contract Settlement)","CR","DA(Customer Document)","DG(Customer Credit Memo)","DR(Customer Invoice)","DV","EU(Euro Rounding Diff.)","EX(External Number)","KA(Vendor Document)","KG(Vendor Credit Memo)","KN(Net Vendors)","KO","KP (Account Maintenance)","KR (Vendor Invoice)","KX","KZ (Vendor Payment)","M1 (MCA Journal)","M2 (FX Swap)","M3 (P&L Lock)","M4 (P&L Close)","M5 (P&L Transformation)","M6 (FX Valuation)","M7 (MAR & Restatement)","M8 (IFX Correction)","M9 (Reversal)","MD (Data Load)","ML (ML Settlement)","MR","P1","P3","P4","PR (Price Change)","RA (Sub.Cred.Memo Stlmt)","RB (Reserve for Bad Debt)","RE (Invoice - Gross)","RN (Invoice - Net)","RV (Billing Doc.Transfer)","SA (G/L Account Document)","SB (G/L Account Posting)","SK (Cash Document)","SU (Adjustment Document)","UE (Data Transfer)","WA (Goods Issue)","WE (Goods Receipt)","WI (Inventory Document)","WL (Goods Issue/Delivery)","WN (Net Goods Receipt)","XX","Y1","ZP (Payment Posting)","ZR (Bank Reconciliation)","ZS (Payment by Check)","ZV (Payment Clearing)","ZZ"],a=(0,n.KR)(0),ee=(0,n.KR)("EUR"),te=window.API_BASE_URL||"",ae=(0,n.KR)(null),ne=(0,n.KR)([]),le=(0,n.KR)([]),oe=(0,n.EW)(()=>ne.value.filter(e=>e.selected)),se=(0,n.EW)(()=>le.value.filter(e=>e.selected)),ce=(0,n.EW)({get(){return 0!==ne.value.length&&oe.value.length===ne.value.length},set(e){ne.value.forEach(t=>{t.selected=e})}}),re=(0,n.EW)({get(){return 0!==le.value.length&&se.value.length===le.value.length},set(e){le.value.forEach(t=>{t.selected=e})}}),ue=(0,n.KR)(!1),ie=(0,n.KR)(""),de=(0,s.$e)((0,s.fV)("dict","dict","payment",null,!1,{},[(0,s.fV)("dict","dict","generalInformation",null,!1,{},[(0,s.fV)("string","leaf","Company Code",null,!1,{searchMethods:c.bk},[]),(0,s.fV)("date","leaf","Posting Date",null,!1,{},[]),(0,s.fV)("date","leaf","Journal Entry Date",null,!1,{},[]),(0,s.fV)("selection","leaf","Journal Entry Type",null,!1,{options:t},[]),(0,s.fV)("string","leaf","Period",null,!1,{},[])],"General Information"),(0,s.fV)("dict","dict","bankData",null,!1,{},[(0,s.fV)("number","leaf","G/L Account",null,!1,{searchMethods:c.Xz},[]),(0,s.fV)("dict","dict","amount",null,!1,{hideLabel:!0},[(0,s.fV)("number","leaf","amount",null,!1,{},[]),(0,s.fV)("string","leaf","unit","EUR",!1,{searchMethods:c.eW,hideLabel:!0},[])])],"Bank Data"),(0,s.fV)("dict","dict","openItemSelection",null,!1,{},[(0,s.fV)("selection","leaf","accountType",null,!1,{options:["Customer","Vendor"]},[],"Account Type"),(0,s.fV)("number","leaf","accountId",null,!1,{searchMethods:c.bk,hideLabel:!0},[],"Account ID")],"Open Item Selection")],"Payment")),ve=(0,n.KR)(null),me=(0,n.KR)(null),pe=(0,n.KR)(null);(0,n.sV)(()=>{const e=de.findNodeByPath(["generalInformation"]);e?ve.value=new s.ab(e):console.error("未能找到 generalInformation 节点");const t=de.findNodeByPath(["bankData"]);t?me.value=new s.ab(t):console.error("未能找到 bankData 节点");const a=de.findNodeByPath(["openItemSelection"]);a?pe.value=new s.ab(a):console.error("未能找到 openItemSelection 节点")});const ke=(0,n.KR)("input"),ye=(0,n.EW)(()=>"input"===ke.value);(0,n.EW)(()=>"post"===ke.value);function fe(e){ke.value=e}async function he(e,t){if(console.log("try: stage change:",e,"->",t),0===e){const e=de.getValue();console.log("待发送的输入数据:",e);try{const t={generalInformation:e.generalInformation,bankData:e.bankData,openItemSelection:e.openItemSelection},n=await fetch(`${te}/api/finance/searchOpenItems`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const l=await n.json();return console.log("后端的查询结果:",l),l.success&&l.data?(ne.value=l.data.openItems?l.data.openItems.map(e=>({...e,selected:!1})):[],a.value="number"===typeof l.data.balance?l.data.balance:parseFloat(l.data.balance||"0"),ee.value=l.data.balanceUnit||"EUR",!0):(console.error("后端返回数据格式不正确:",l),alert("查询未清项失败："+(l.message||"数据格式错误")),ne.value=[],a.value=0,ee.value="EUR",!1)}catch(n){return console.error("发送请求或处理响应时发生错误:",n),alert("查询未清项失败，请检查网络或联系管理员。"),ne.value=[],a.value=0,ee.value="EUR",!1}}if(1===e){const e=le.value;if(console.log("准备提交的未清项:",e),a.value<0)return alert("客户少付款，无法提交未清项。"),!1;if(a.value>0)return alert("客户多付款，无法提交未清项。"),!1;try{const t=await fetch(`${te}/api/finance/postOpenItems`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await t.json();return a.success?(ie.value=a.data.mockJournalEntry.journalEntryId||"N/A",ue.value=!0,ae.value.footerMessage="",console.log("过账成功:",a),!0):(alert("过账失败："+(a.message||"未知错误")),!1)}catch(n){return console.error("过账时发生错误:",n),alert("过账失败，请检查网络。"),!1}}return!0}async function Le(e,t){if(1===e){const n=confirm("Cancel?");return n&&(ae.value.footerMessage="",ne.value=[],a.value=0,ee.value="EUR"),console.log("取消操作，返回到输入阶段"),console.log("当前阶段:",e,"目标阶段:",t),console.log("确认值:",n),fe("input"),n}return!0}async function ge(e,t){0===e&&(fe("post"),ae.value.footerMessage="Open items have been loaded")}async function be(e,t){}function Ee(e){e.selected=!e.selected}function Ce(){const e=ne.value.filter(e=>e.selected);if(0===e.length)return void alert("请先选择要清除的未清项！");let t=0;e.forEach(e=>{t+=e.amount}),le.value.push(...e),ne.value=ne.value.filter(e=>!e.selected),a.value-=t,le.value.forEach(e=>{e.selected=!1}),console.log(`成功清除 ${e.length} 项未清项。`)}function we(){const e=le.value.filter(e=>e.selected);if(0===e.length)return void alert("请先选择要移除的项！");ne.value.push(...e),le.value=le.value.filter(e=>!e.selected);let t=0;e.forEach(e=>{t+=e.amount}),a.value+=t,le.value.forEach(e=>{e.selected=!1}),console.log(`成功移除 ${e.length} 项已清除项。`)}function De(){ue.value=!1,console.log("关闭过账成功模态框"),ne.value=[],le.value=[],a.value=0,ee.value="EUR",ae.value.goToStage(0),fe("input")}function Ae(){ue.value=!1,ie.value?r.A.push({name:"DisplayJournalEntry",params:{id:ie.value}}):alert("无法获取凭证编号进行查看。")}return(e,t)=>((0,n.uX)(),(0,n.Wv)(o.A,{stages:["input","post"],"before-next":he,"before-prev":Le,"after-next":ge,"after-prev":be,"footer-config":[{nextText:"Propose items"},{prevText:"Cancel",nextText:"Post"}],ref_key:"appContentRef",ref:ae},{["stage-input"]:(0,n.k6)(()=>[(0,n.Lk)("div",u,[(0,n.Lk)("div",i,[(0,n.bo)((0,n.bF)(l.A,{tree:ve.value},null,8,["tree"]),[[n.aG,ye.value]])]),(0,n.Lk)("div",d,[(0,n.bo)((0,n.bF)(l.A,{tree:me.value},null,8,["tree"]),[[n.aG,ye.value]])]),(0,n.Lk)("div",v,[(0,n.bo)((0,n.bF)(l.A,{tree:pe.value},null,8,["tree"]),[[n.aG,ye.value]])])])]),["stage-post"]:(0,n.k6)(()=>[(0,n.Lk)("div",m,[t[4]||(t[4]=(0,n.Lk)("div",null,[(0,n.Lk)("span",{style:{"font-weight":"bold"}},"Open Items")],-1)),(0,n.Lk)("div",p,[(0,n.Lk)("span",k,"Balance:  "+(0,n.v_)(a.value+" "+ee.value),1)])]),ne.value&&ne.value.length>0?((0,n.uX)(),(0,n.CE)("div",y,[(0,n.Lk)("div",f,[t[6]||(t[6]=(0,n.Lk)("div",{class:"material-document-row-header"},[(0,n.Lk)("div",{class:"header-item checkbox-header"},"No."),(0,n.Lk)("div",{class:"header-item company-code"},"Company Code"),(0,n.Lk)("div",{class:"header-item account"},"Account"),(0,n.Lk)("div",{class:"header-item journal-entry"},"Journal Entry"),(0,n.Lk)("div",{class:"header-item journal-entry-type"},"Journal Entry Type"),(0,n.Lk)("div",{class:"header-item journal-entry-date"},"Journal Entry Date"),(0,n.Lk)("div",{class:"header-item net-due-date"},"Net Due Date"),(0,n.Lk)("div",{class:"header-item amount"},"Amount"),(0,n.Lk)("div",{class:"header-item assignment"},"Assignment"),(0,n.Lk)("div",{class:"header-item"})],-1)),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(ne.value,(e,a)=>((0,n.uX)(),(0,n.CE)("div",{key:a,class:"material-document-row",onClick:t=>Ee(e)},[(0,n.Lk)("div",L,[(0,n.bo)((0,n.Lk)("input",{type:"checkbox",onClick:t[0]||(t[0]=(0,n.D$)(()=>{},["stop"])),"onUpdate:modelValue":t=>e.selected=t},null,8,g),[[n.lH,e.selected]])]),(0,n.Lk)("span",b,(0,n.v_)(e.companyCode),1),(0,n.Lk)("span",E,(0,n.v_)(e.account),1),(0,n.Lk)("span",C,(0,n.v_)(e.journalEntry),1),(0,n.Lk)("span",w,(0,n.v_)(e.journalEntryType),1),(0,n.Lk)("span",D,(0,n.v_)(e.journalEntryDate),1),(0,n.Lk)("span",A,(0,n.v_)(e.netDueDate),1),(0,n.Lk)("span",R,(0,n.v_)(e.amount),1),(0,n.Lk)("span",I,(0,n.v_)(e.assignment),1),t[5]||(t[5]=(0,n.Lk)("span",{class:"row-item arrow-icon"},"▶",-1))],8,h))),128))])])):((0,n.uX)(),(0,n.CE)("div",P,t[7]||(t[7]=[(0,n.Lk)("p",null,"No open items found.",-1)]))),(0,n.Lk)("div",V,[(0,n.Lk)("div",_,[(0,n.bo)((0,n.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=e=>ce.value=e),disabled:0===ne.value.length},null,8,S),[[n.lH,ce.value]]),t[8]||(t[8]=(0,n.Lk)("span",null,"Select All",-1))]),(0,n.Lk)("div",x,[(0,n.Lk)("span",null,"Already Selected "+(0,n.v_)(oe.value.length)+" / Total "+(0,n.v_)(ne.value.length),1)])]),(0,n.Lk)("div",{class:"btn-container"},[(0,n.Lk)("button",{class:"btn",onClick:Ce}," clear "),(0,n.Lk)("button",{class:"btn",onClick:we}," remove ")]),t[16]||(t[16]=(0,n.Lk)("div",{style:{display:"flex","justify-content":"space-between","align-items":"center",padding:"10px"}},[(0,n.Lk)("span",{style:{"font-weight":"bold"}},"Items to be cleared")],-1)),le.value&&le.value.length>0?((0,n.uX)(),(0,n.CE)("div",j,[(0,n.Lk)("div",M,[t[10]||(t[10]=(0,n.Lk)("div",{class:"material-document-row-header"},[(0,n.Lk)("div",{class:"header-item checkbox-header"},"No."),(0,n.Lk)("div",{class:"header-item company-code"},"Company Code"),(0,n.Lk)("div",{class:"header-item account"},"Account"),(0,n.Lk)("div",{class:"header-item journal-entry"},"Journal Entry"),(0,n.Lk)("div",{class:"header-item journal-entry-type"},"Journal Entry Type"),(0,n.Lk)("div",{class:"header-item journal-entry-date"},"Journal Entry Date"),(0,n.Lk)("div",{class:"header-item net-due-date"},"Net Due Date"),(0,n.Lk)("div",{class:"header-item amount"},"Amount"),(0,n.Lk)("div",{class:"header-item assignment"},"Assignment"),(0,n.Lk)("div",{class:"header-item"})],-1)),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(le.value,(e,a)=>((0,n.uX)(),(0,n.CE)("div",{key:a,class:"material-document-row",onClick:t=>Ee(e)},[(0,n.Lk)("div",N,[(0,n.bo)((0,n.Lk)("input",{type:"checkbox",onClick:t[2]||(t[2]=(0,n.D$)(()=>{},["stop"])),"onUpdate:modelValue":t=>e.selected=t},null,8,T),[[n.lH,e.selected]])]),(0,n.Lk)("span",U,(0,n.v_)(e.companyCode),1),(0,n.Lk)("span",X,(0,n.v_)(e.account),1),(0,n.Lk)("span",W,(0,n.v_)(e.journalEntry),1),(0,n.Lk)("span",G,(0,n.v_)(e.journalEntryType),1),(0,n.Lk)("span",J,(0,n.v_)(e.journalEntryDate),1),(0,n.Lk)("span",B,(0,n.v_)(e.netDueDate),1),(0,n.Lk)("span",F,(0,n.v_)(e.amount),1),(0,n.Lk)("span",O,(0,n.v_)(e.assignment),1),t[9]||(t[9]=(0,n.Lk)("span",{class:"row-item arrow-icon"},"▶",-1))],8,K))),128))])])):((0,n.uX)(),(0,n.CE)("div",$,t[11]||(t[11]=[(0,n.Lk)("p",null,"No items to be cleared.",-1)]))),(0,n.Lk)("div",Z,[(0,n.Lk)("div",H,[(0,n.bo)((0,n.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=e=>re.value=e),disabled:0===le.value.length},null,8,q),[[n.lH,re.value]]),t[12]||(t[12]=(0,n.Lk)("span",null,"Select All",-1))]),(0,n.Lk)("div",z,[(0,n.Lk)("span",null,"Already Selected "+(0,n.v_)(se.value.length)+" / Total "+(0,n.v_)(le.value.length),1)])]),ue.value?((0,n.uX)(),(0,n.CE)("div",Q,[(0,n.Lk)("div",Y,[t[15]||(t[15]=(0,n.Lk)("h2",null,"Success",-1)),(0,n.Lk)("span",null,[t[13]||(t[13]=(0,n.eW)("Journal Entry ")),(0,n.Lk)("span",null,(0,n.v_)(ie.value),1),t[14]||(t[14]=(0,n.eW)(" Successfully Posted"))]),(0,n.Lk)("div",{class:"modal-actions"},[(0,n.Lk)("button",{class:"btn",onClick:Ae},"View Details"),(0,n.Lk)("button",{class:"btn",onClick:De},"Close")])])])):(0,n.Q3)("",!0)]),["footer-content-right"]:(0,n.k6)(()=>[(0,n.eW)((0,n.v_)(ae.value?.getCurrentStageName()),1)]),_:2},1536))}}),te=a(1241);const ae=(0,te.A)(ee,[["__scopeId","data-v-fa345ee2"]]);var ne=ae}}]);
//# sourceMappingURL=118.63fe3cdf.js.map