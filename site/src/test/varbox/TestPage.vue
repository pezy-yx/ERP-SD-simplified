<template>
  <div>
    <div class="test-page">
      <h1>VarTreeç»„ä»¶æµ‹è¯•</h1>

      <!-- ç®€å•ç±»å‹æµ‹è¯• -->
      <div class="test-section">
        <h2>1. ç®€å•ç±»å‹æµ‹è¯•</h2>
        
        <div class="test-item">
          <h3>å•ä¸ªVarNodeï¼ˆå­—ç¬¦ä¸²å¶å­èŠ‚ç‚¹ï¼‰</h3>
          <var-input
            :varTree="simpleStringTree"
            :nodePath="[]"
            :showLabel="true"
            @update="handleUpdate('simpleString', $event)"
          />
          <div class="result-preview">
            <strong>å½“å‰å€¼ï¼š</strong>{{ JSON.stringify(testResults.simpleString) }}
          </div>
        </div>

        <div class="test-item">
          <h3>æ•°å­—ç±»å‹èŠ‚ç‚¹</h3>
          <var-input
            :varTree="simpleNumberTree"
            :nodePath="[]"
            :showLabel="true"
            @update="handleUpdate('simpleNumber', $event)"
          />
          <div class="result-preview">
            <strong>å½“å‰å€¼ï¼š</strong>{{ JSON.stringify(testResults.simpleNumber) }}
          </div>
        </div>

        <div class="test-item">
          <h3>æ—¥æœŸç±»å‹èŠ‚ç‚¹</h3>
          <var-input
            :varTree="simpleDateTree"
            :nodePath="[]"
            :showLabel="true"
            :config="{ minDate: '2024-01-01', maxDate: '2025-12-31' }"
            @update="handleUpdate('simpleDate', $event)"
          >
            <template #[`birthday--simple`]>
              HELLO
            </template>
          </var-input>
          <div class="result-preview">
            <strong>å½“å‰å€¼ï¼š</strong>{{ JSON.stringify(testResults.simpleDate) }}
          </div>
        </div>

        <div class="test-item">
          <h3>é€‰æ‹©ç±»å‹èŠ‚ç‚¹</h3>
          <var-input
            :varTree="simpleSelectionTree"
            :nodePath="[]"
            :config="{ options: ['é€‰é¡¹1', 'é€‰é¡¹2', 'é€‰é¡¹3', 'é€‰é¡¹4'] }"
            @update="handleUpdate('simpleSelection', $event)"
          />
          <div class="result-preview">
            <strong>å½“å‰å€¼ï¼š</strong>{{ JSON.stringify(testResults.simpleSelection) }}
          </div>
        </div>
      </div>

      <!-- å¤æ‚ç±»å‹æµ‹è¯• -->
      <div class="test-section">
        <h2>2. å¤æ‚ç±»å‹æµ‹è¯•</h2>
        
        <div class="test-item">
          <h3>ä¸‰å±‚å­—å…¸åµŒå¥—</h3>
          <var-input
            :varTree="threeLevelDictTree"
            :nodePath="[]"
            @update="handleUpdate('threeLevelDict', $event)"
          />
          <div class="result-preview">
            <strong>å½“å‰å€¼ï¼š</strong>
            <pre>{{ JSON.stringify(testResults.threeLevelDict, null, 2) }}</pre>
          </div>
        </div>

        <div class="test-item">
          <h3>ä¸‰å±‚åˆ—è¡¨åµŒå¥—</h3>
          <var-input
            :varTree="threeLevelListTree"
            :nodePath="[]"
            :config="{
            }"
            @update="handleUpdate('threeLevelList', $event)"
          />
          <div class="result-preview">
            <strong>å½“å‰å€¼ï¼š</strong>
            <pre>{{ JSON.stringify(testResults.threeLevelList, null, 2) }}</pre>
          </div>
        </div>

        <div class="test-item">
          <h3>æ··åˆå­—å…¸å’Œåˆ—è¡¨</h3>
          <var-input
            :varTree="mixedTree"
            :nodePath="[]"
            @update="handleUpdate('mixed', $event)"
          >
            <template #student-class--extra>
              <!-- im an empty slot, overcoming so many layers -->
              <button>HELLO</button>
            </template>
          </var-input>
          <div class="result-preview">
            <strong>å½“å‰å€¼ï¼š</strong>
            <pre>{{ JSON.stringify(testResults.mixed, null, 2) }}</pre>
          </div>
        </div>
      </div>

      <!-- åŠŸèƒ½ç‰¹æ€§æµ‹è¯• -->
      <div class="test-section">
        <h2>3. åŠŸèƒ½ç‰¹æ€§æµ‹è¯•</h2>
        
        <div class="test-item">
          <h3>åªè¯»æ¨¡å¼</h3>
          <var-input
            :varTree="readonlyTree"
            :nodePath="[]"
            :readonly="true"
            @update="handleUpdate('readonly', $event)"
          />
        </div>

        <div class="test-item">
          <h3>åŠ¨æ€åˆ—è¡¨ï¼ˆå¯æ·»åŠ åˆ é™¤ï¼‰</h3>
          <var-input
            :varTree="dynamicListTree"
            :nodePath="[]"
            :config="{
              maxLength: 5,
            }"
            @update="handleUpdate('dynamicList', $event)"
          />
          <div class="result-preview">
            <strong>å½“å‰å€¼ï¼š</strong>
            <pre>{{ JSON.stringify(testResults.dynamicList, null, 2) }}</pre>
          </div>
        </div>

        <div class="test-item">
          <h3>è¡¨æ ¼æ˜¾ç¤ºæµ‹è¯•ï¼ˆDictä½œä¸ºåˆ—è¡¨é¡¹ï¼‰</h3>
          <var-input
            :varTree="tableTestTree"
            :nodePath="[]"
            @update="handleUpdate('tableTest', $event)"
          >
            <template #--slot>
              Top Slot
            </template>
          </var-input>
          <div class="result-preview">
            <strong>å½“å‰å€¼ï¼š</strong>
            <pre>{{ JSON.stringify(testResults.tableTest, null, 2) }}</pre>
          </div>
        </div>

        <div class="test-item">
          <h3>ä¾¿æ·æ„é€ æ–¹æ³•æµ‹è¯•</h3>
          <var-input
            :varTree="configBasedTree"
            :nodePath="[]"
            @update="handleUpdate('configBased', $event)"
          >
            <template v-for="i in [0,2,6]" #[`employee-projects-${i}-startDate--simple-input-group`]="slotProps">
              <p>im an empty slot {{ i }}, overcoming so many layers</p>
              <button @click="slotProps.showDatePicker()">Show Date Picker for Row {{ i }}</button>
              <p>only row 0,2,6 will be customized</p>
              <span style="color: blue;">å½“å‰ç´¢å¼•: {{ i }}</span>
            </template>
          </var-input>
          <div class="result-preview">
            <strong>å½“å‰å€¼ï¼š</strong>
            <pre>{{ JSON.stringify(testResults.configBased, null, 2) }}</pre>
          </div>
          <!-- <div class="config-preview">
            <strong>é…ç½®å¯¹è±¡ï¼š</strong>
            <pre>{{ JSON.stringify(configObject, null, 2) }}</pre>
          </div> -->
        </div>

        <!-- æ–°åŠŸèƒ½æµ‹è¯•ï¼šé¢å¤–ç»„ä»¶æ’æ§½å’Œè‡ªå®šä¹‰å¸ƒå±€ -->
        <div class="test-item">
          <h3>é¢å¤–ç»„ä»¶æ’æ§½æµ‹è¯•</h3>
          
          <h4>æœç´¢è¾“å…¥æ¡†ï¼ˆæ°´å¹³å¸ƒå±€ï¼‰</h4>
          <var-input
            :varTree="simpleStringTree"
            :nodePath="[]"
            :config="{ classPrefix: 'search-input' }"
            :showLabel = "true"
            @update="handleUpdate('searchInput', $event)"
          >
            <template #ç”¨æˆ·å--extra="allProps">
              <button class="search-btn" @click="handleSearch(allProps)">ğŸ” æœç´¢</button>
              <button class="clear-btn" @click="handleClear(allProps)">âœ–ï¸ æ¸…é™¤</button>
            </template>
          </var-input>
          <div class="result-preview">
            <strong>å½“å‰å€¼ï¼š</strong>{{ JSON.stringify(testResults.searchInput) }}
          </div>

          <h4>æ•°å€¼è¾“å…¥æ¡†ï¼ˆå‚ç›´å¸ƒå±€ï¼‰</h4>
          <var-input
            :varTree="simpleNumberTree"
            :nodePath="[]"
            :config="{ classPrefix: 'number-input' }"
            :showLabel = "true"
            @update="handleUpdate('numberInput', $event)"
          >
            <template #å¹´é¾„--extra="allProps">
              <div class="number-controls">
                <button @click="increment(allProps)">+ å¢åŠ </button>
                <button @click="decrement(allProps)">- å‡å°‘</button>
                <span class="number-info">å½“å‰å€¼: {{ allProps.currentNode?.currentValue || 0 }}</span>
              </div>
            </template>
          </var-input>
          <div class="result-preview">
            <strong>å½“å‰å€¼ï¼š</strong>{{ JSON.stringify(testResults.numberInput) }}
          </div>
        </div>
      </div>

      <!-- å…¨å±€æ•°æ®é¢„è§ˆ -->
      <!-- <div class="global-preview">
        <h2>å…¨å±€æ•°æ®é¢„è§ˆ</h2>
        <pre>{{ JSON.stringify(testResults, null, 2) }}</pre>
      </div> -->
    </div>

    <!-- VarBoxCaseså…¨é‡æµ‹è¯•åŒº -->
    <div class="testcase-demo-root">
      <nav class="testcase-nav">
        <div class="testcase-nav-title">VarBox TestCaseç›®å½•</div>
        <ul>
          <li v-for="name in testcaseNames" :key="name">
            <a :href="'#testcase-'+name">{{ name }}</a>
          </li>
        </ul>
      </nav>
      <div class="testcase-list">
        <div
          v-for="name in testcaseNames"
          :key="name"
          class="testcase-item"
          :id="'testcase-'+name"
        >
          <h3>{{ name }}</h3>
          <var-box
            :tree="testCases[name].tree"
            :nodePath="[]"
          />
          <div class="result-preview">
            <strong>å½“å‰å€¼ï¼š</strong>
            <pre>{{ JSON.stringify(testCases[name].tree.root?.currentValue, null, 2) }}</pre>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<style scoped>
.testcase-demo-root {
  display: flex;
  margin-top: 48px;
  min-height: 400px;
}
.testcase-nav {
  position: fixed;
  top: 80px;
  left: 0;
  width: 180px;
  background: #f8f8fc;
  border-right: 2px solid #eee;
  padding: 16px 8px 16px 16px;
  z-index: 10;
  font-size: 15px;
  border-radius: 0 12px 12px 0;
  box-shadow: 2px 0 8px #eee;
}
.testcase-nav-title {
  font-weight: bold;
  margin-bottom: 12px;
  color: #7c5fd4;
}
.testcase-nav ul {
  list-style: none;
  padding: 0;
  margin: 0;
}
.testcase-nav li {
  margin-bottom: 8px;
}
.testcase-nav a {
  color: #5a4fcf;
  text-decoration: none;
  transition: color 0.2s;
}
.testcase-nav a:hover {
  color: #e67e22;
  text-decoration: underline;
}
.testcase-list {
  margin-left: 200px;
  flex: 1;
  padding: 8px 24px;
}
.testcase-item {
  margin-bottom: 36px;
  padding: 18px 16px 16px 16px;
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 2px 8px #f0f0f0;
  border: 1px solid #f3f3f3;
}
.testcase-item h3 {
  margin-top: 0;
  color: #6b4fcf;
}
</style>
 
<script lang = "ts">
import VarInput from '@/components/varbox/VarInput.vue'
import VarBox from '@/components/varbox/VarBox.vue'
import { VarTree, VarNode, validators, createTreeFromConfig, NodeStructure, VarTypeString } from '@/utils/VarTree'
import MyCustomInput from '@/test/varbox/MyCustomInput.vue'
import { testCases } from '@/test/varbox/VarInputCases'
import { markRaw } from 'vue'

export default {
  name: 'NewTestPage',

  components: {
    VarInput,
    VarBox,
    MyCustomInput
  },

  data() {
    return {
      validators,
      testcaseNames: Object.keys(testCases),
      testCases,
      testResults: {
        simpleString: '',
        simpleNumber: 0,
        simpleDate: '',
        simpleSelection: '',
        threeLevelDict: {},
        threeLevelList: [],
        mixed: {},
        readonly: {},
        dynamicList: [],
        tableTest: [],
        configBased: {},
        // æ–°å¢çš„æµ‹è¯•æ•°æ®
        searchInput: '',
        numberInput: 0,
        fileInput: ''
      } as {
        [key: string]: any;
        simpleString: string;
        simpleNumber: number;
        simpleDate: string;
        simpleSelection: string;
        threeLevelDict: object;
        threeLevelList: any[];
        mixed: object;
        readonly: object;
        dynamicList: any[];
        tableTest: any[];
        configBased: object;
        // æ–°å¢å­—æ®µçš„ç±»å‹å®šä¹‰
        searchInput: string;
        numberInput: number;
        fileInput: string;
      },
      // é…ç½®å¯¹è±¡ç¤ºä¾‹
      configObject: {
        varType: 'dict',
        name: 'employee',
        children: [
          {
            varType: 'dict',
            name: 'basicInfo',
            children: [
              { varType: 'string', name: 'name', defaultValue: 'å¼ ä¸‰'},
              { varType: 'number', name: 'age', defaultValue: 28 },
              {
                varType: 'selection', name: 'gender', defaultValue: 'ç”·', config: {
                  options: ['ç”·', 'å¥³', 'å…¶ä»–']
                }
              },
              { varType: 'date', name: 'birthDate', defaultValue: '1995-01-01' }
            ]
          },
          {
            varType: 'dict',
            name: 'workInfo',
            children: [
              { varType: 'string', name: 'department', defaultValue: 'æŠ€æœ¯éƒ¨' },
              { varType: 'string', name: 'position', defaultValue: 'è½¯ä»¶å·¥ç¨‹å¸ˆ' },
              { varType: 'number', name: 'salary', defaultValue: 8000 },
              {
                varType: 'fixlist',
                name: 'skills',
                children: [
                  { varType: 'string', defaultValue: 'JavaScript' },
                  { varType: 'string', defaultValue: 'Vue.js' , readonly: true},
                  { varType: 'string', defaultValue: 'Python' },
                  { varType: 'number', defaultValue: 123 }
                ]
              }
            ]
          },
          {
            varType: 'dynamiclist',
            name: 'projects',
            children: [
              { varType: 'dict', name:"lan", children: [
                { varType: 'string', name: 'projectName', defaultValue: 'é¡¹ç›®A' },
                { varType: 'string', name: 'role', defaultValue: 'å¼€å‘', config: {customComponent: markRaw(MyCustomInput)} },
                { varType: 'date', name: 'startDate', defaultValue: '2023-01-01' },
                { varType: 'date', name: 'endDate', defaultValue: '2023-12-31' }
              ]},
              { varType: 'dict', name:"lan", children: [
                { varType: 'string', name: 'projectName', defaultValue: 'é¡¹ç›®B' },
                { varType: 'string', name: 'role', defaultValue: 'æµ‹è¯•' },
                { varType: 'date', name: 'startDate', defaultValue: '2024-01-01' },
                { varType: 'date', name: 'endDate', defaultValue: '2024-12-31' }
              ]}
            ],
            config: {
              childTemplate: {
                varType: 'dict',
                children: [
                  { varType: 'string', name: 'projectName', defaultValue: '' },
                  { varType: 'string', name: 'role', defaultValue: '' },
                  { varType: 'date', name: 'startDate', defaultValue: '' },
                  { varType: 'date', name: 'endDate', defaultValue: '' }
                ]
              }
            }
          }
        ]
      } as NodeStructure
    }
  },

  computed: {
    // ç®€å•å­—ç¬¦ä¸²æ ‘
    simpleStringTree(): VarTree {
      const config: NodeStructure = { varType: 'string', name: 'ç”¨æˆ·å', defaultValue: '', nameDisplay:'ç”¨æˆ·å:', config: {
        validators: [
          {
            creteria:(val: any) => {
              const flag = val === '123'
              return flag
            },
            message: "å€¼ä¸æ˜¯123"
          }
        ],
      }}
      return createTreeFromConfig(config)
    },

    // ç®€å•æ•°å­—æ ‘
    simpleNumberTree(): VarTree {
      const config: NodeStructure = { varType: 'number', name: 'å¹´é¾„', defaultValue: 0 }
      return createTreeFromConfig(config)
    },

    // ç®€å•æ—¥æœŸæ ‘
    simpleDateTree(): VarTree {
      const config: NodeStructure = { varType: 'date', name: 'birthday', defaultValue: '' }
      return createTreeFromConfig(config)
    },

    // ç®€å•é€‰æ‹©æ ‘
    simpleSelectionTree(): VarTree {
      const config: NodeStructure = { varType: 'selection', name: 'çº§åˆ«', defaultValue: 'é€‰é¡¹1' }
      return createTreeFromConfig(config)
    },

    // ä¸‰å±‚å­—å…¸åµŒå¥—
    threeLevelDictTree(): VarTree {
      const config: NodeStructure = {
        varType: 'dict',
        name: 'user',
        children: [
          {
            varType: 'string',
            name: 'id',
            defaultValue: 'user_001'
          },
          {
            varType: 'dict',
            name: 'personal',
            children: [
              { varType: 'string', name: 'name', defaultValue: 'å¼ ä¸‰' },
              { varType: 'number', name: 'age', defaultValue: 25 },
              {
                varType: 'dict',
                name: 'address',
                children: [
                  { varType: 'string', name: 'province', defaultValue: 'å¹¿ä¸œçœ' },
                  { varType: 'string', name: 'city', defaultValue: 'æ·±åœ³å¸‚' },
                  { varType: 'string', name: 'district', defaultValue: 'å—å±±åŒº' }
                ]
              }
            ]
          },
          {
            varType: 'string',
            name: 'email',
            defaultValue: 'test@example.com'
          }
        ]
      }
      return createTreeFromConfig(config)
    },

    // ä¸‰å±‚åˆ—è¡¨åµŒå¥—
    threeLevelListTree(): VarTree {
      const config: NodeStructure = {
        varType: 'fixlist',
        name: 'matrix',
        children: [
          {
            varType: 'fixlist',
            children: [
              {
                varType: 'fixlist',
                children: [
                  { varType: 'string', defaultValue: 'item1' },
                  { varType: 'string', defaultValue: 'item2' }
                ]
              },
              {
                varType: 'fixlist',
                children: [
                  { varType: 'string', defaultValue: 'item3' },
                  { varType: 'string', defaultValue: 'item4' }
                ]
              }
            ]
          }
        ]
      }
      return createTreeFromConfig(config)
    },

    // æ··åˆå­—å…¸å’Œåˆ—è¡¨
    mixedTree(): VarTree {
      const config: NodeStructure = {
        varType: 'dict',
        name: 'student',
        children: [
          { varType: 'string', name: 'name', defaultValue: 'æå››' },
          { varType: 'string', name: 'class', defaultValue: 'ä¸‰å¹´çº§ä¸€ç­' },
          { varType: 'date', name: 'birthday', defaultValue: '2004/03/14' },
          { varType: 'dynamiclist', name: 'scores', 
            children: [
              { varType: 'dict', name: 'math', children: [
                { varType: 'string', name: 'subject', defaultValue: 'æ•°å­¦' },
                { varType: 'number', name: 'score', defaultValue: 95 }
              ]},
              { varType: 'dict', name: 'english', children: [
                { varType: 'string', name: 'subject', defaultValue: 'è‹±è¯­' },
                { varType: 'number', name: 'score', defaultValue: 88 }
              ]}
            ]
          }
        ]
      }
      return createTreeFromConfig(config)
    },

    // åªè¯»æ ‘
    readonlyTree(): VarTree {
      const config: NodeStructure = {
        varType: 'dict',
        name: 'readonly_data',
        readonly: true,
        children: [
          { varType: 'string', name: 'ç³»ç»Ÿç‰ˆæœ¬', defaultValue: 'v1.0.0', readonly: true },
          { varType: 'string', name: 'åˆ›å»ºæ—¶é—´', defaultValue: '2024-01-01', readonly: true },
          { varType: 'number', name: 'ç”¨æˆ·æ•°é‡', defaultValue: 1000, readonly: true }
        ]
      }
      return createTreeFromConfig(config)
    },

    // åŠ¨æ€åˆ—è¡¨æ ‘
    dynamicListTree(): VarTree {
      const config: NodeStructure = {
        varType: 'dynamiclist',
        nodeType: 'list',
        name: 'students',
        children: [{
            varType: 'dict',
            children: [
              { varType: 'string', name: 'name', defaultValue: 'å­¦ç”Ÿå§“å' },
              { varType: 'number', name: 'score', defaultValue: 100 }
            ]
          }],
        config: {
          childTemplate: {
            varType: 'dict',
            children: [
              { varType: 'string', name: 'name'},
              { varType: 'number', name: 'score'}
            ]
          },
          maxLength: 10
        }
      }
      return createTreeFromConfig(config)
    },

    // è¡¨æ ¼æ˜¾ç¤ºæµ‹è¯•æ ‘
    tableTestTree(): VarTree {
      const config: NodeStructure = {
        varType: 'fixlist',
        name: 'student_table',
        children: [
          {
            varType: 'dict',
            children: [
              { varType: 'string', name: 'name', defaultValue: 'å¼ ä¸‰' },
              { varType: 'number', name: 'age', defaultValue: 20 },
              { varType: 'string', name: 'major', defaultValue: 'è®¡ç®—æœºç§‘å­¦' }
            ]
          },
          {
            varType: 'dict',
            children: [
              { varType: 'string', name: 'name', defaultValue: 'æå››' },
              { varType: 'number', name: 'age', defaultValue: 21 },
              { varType: 'string', name: 'major', defaultValue: 'è½¯ä»¶å·¥ç¨‹' }
            ]
          },
          {
            varType: 'dict',
            children: [
              { varType: 'string', name: 'name', defaultValue: 'ç‹äº”' },
              { varType: 'number', name: 'age', defaultValue: 19 },
              { varType: 'string', name: 'major', defaultValue: 'æ•°æ®ç§‘å­¦' }
            ]
          }
        ]
      }
      return createTreeFromConfig(config)
    },

    // ä¾¿æ·æ„é€ æ–¹æ³•æµ‹è¯•æ ‘
    configBasedTree(): VarTree {
      return createTreeFromConfig((this as any).configObject as NodeStructure)
    }
  },

  mounted() {
    // åˆå§‹åŒ–æ‰€æœ‰å¤æ‚ç±»å‹çš„æ•°æ®é¢„è§ˆ
    (this as any).initializeComplexData()
  },

  methods: {
    // åˆå§‹åŒ–å¤æ‚æ•°æ®é¢„è§ˆ
    initializeComplexData() {
      const complexKeys = ['threeLevelDict', 'threeLevelList', 'mixed', 'readonly', 'dynamicList', 'tableTest', 'configBased']
      
      complexKeys.forEach(key => {
        const tree = (this as any).getTreeByKey(key)
        if (tree && tree.root) {
          (this as any).testResults[key] = tree.root.currentValue
        }
      })
    },
    handleUpdate(key: string, updateInfo: any) {
      const tree = (this as any).getTreeByKey(key)
      if (!tree || !tree.root) return
      if (tree.root.isLeaf()) {
        (this as any).testResults[key] = updateInfo.value
      } else {
        (this as any).testResults[key] = tree.root.currentValue
      }
    },

    // æ ¹æ®keyè·å–å¯¹åº”çš„æ ‘
    getTreeByKey(key: any): VarTree | undefined {
      const treeMap = {
        simpleString: (this as any).simpleStringTree,
        simpleNumber: (this as any).simpleNumberTree,
        simpleDate: (this as any).simpleDateTree,
        simpleSelection: (this as any).simpleSelectionTree,
        threeLevelDict: (this as any).threeLevelDictTree,
        threeLevelList: (this as any).threeLevelListTree,
        mixed: (this as any).mixedTree,
        readonly: (this as any).readonlyTree,
        dynamicList: (this as any).dynamicListTree,
        tableTest: (this as any).tableTestTree,
        configBased: (this as any).configBasedTree,
        searchInput: (this as any).simpleStringTree,
        numberInput: (this as any).simpleNumberTree,
      }
      return treeMap[key as keyof typeof treeMap] as VarTree | undefined
    },

    // æ–°å¢çš„é¢å¤–ç»„ä»¶åŠŸèƒ½æ–¹æ³•
    handleSearch(varProps: any) {
      alert(`æœç´¢å†…å®¹: ${varProps.currentNode?.currentValue || 'ç©º'}`)
    },

    handleClear(varProps: any) {
      if (varProps.currentNode) {
        varProps.setNodeValue('')
      }
    },

    increment(varProps: any) {
      if (varProps.currentNode) {
        const value = varProps.getNodeValue()
        const newValue = Number(value) + 1
        varProps.setNodeValue(newValue)
      }
    },

    decrement(varProps: any) {
      if (varProps.currentNode) {
        const value = varProps.getNodeValue()
        const newValue = Number(value) - 1
        varProps.setNodeValue(newValue)
      }
    },
  }
}
</script>

<style scoped>
.test-page {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
  font-family: Arial, sans-serif;
}

h1 {
  text-align: center;
  color: #409EFF;
  margin-bottom: 40px;
  font-size: 28px;
}

.test-section {
  margin-bottom: 50px;
  border: 1px solid #EBEEF5;
  border-radius: 8px;
  padding: 25px;
  background-color: #FAFAFA;
}

h2 {
  color: #606266;
  border-bottom: 2px solid #409EFF;
  padding-bottom: 10px;
  margin-bottom: 25px;
  font-size: 20px;
}

.test-item {
  margin-bottom: 35px;
  padding: 20px;
  border: 1px solid #DCDFE6;
  border-radius: 6px;
  background-color: white;
}

h3 {
  color: #909399;
  margin-bottom: 15px;
  font-size: 16px;
  border-left: 4px solid #409EFF;
  padding-left: 10px;
}

pre {
  max-height: 300px;
  overflow-y: scroll;
}

.result-preview {
  margin-top: 15px;
  padding: 15px;
  background-color: #F5F7FA;
  border-radius: 4px;
  border-left: 4px solid #409EFF;
}

.result-preview pre {
  margin: 10px 0 0 0;
  white-space: pre-wrap;
  word-wrap: break-word;
  font-size: 12px;
  line-height: 1.4;
}

.global-preview {
  margin-top: 40px;
  padding: 25px;
  background: #F0F9FF;
  border-radius: 8px;
  border: 1px solid #409EFF;
}

.global-preview h2 {
  color: #409EFF;
  border-bottom-color: #409EFF;
}

/* æ–°å¢çš„é¢å¤–ç»„ä»¶å¸ƒå±€æ ·å¼ */

/* æœç´¢è¾“å…¥æ¡† - æ°´å¹³å¸ƒå±€ */
:deep(.search-input--wrapper) {
  display: flex;
  align-items: center;
  gap: 8px;
  border: 1px solid #ddd;
  border-radius: 6px;
  padding: 8px;
  background-color: #fff;
}
:deep(.search-input--wrapper .search-btn) {
  scale: 1.2;
  transform: translateX(0, 50px);
}
:deep(.search-input--main) {
  display: flex;
  flex: 1;
}

:deep(.search-input--extra) {
  display: flex;
  gap: 4px;
}

:deep(.search-btn, .clear-btn) {
  padding: 4px 8px;
  border: 1px solid #409EFF;
  border-radius: 4px;
  background-color: #409EFF;
  color: white;
  cursor: pointer;
  font-size: 12px;
  transition: all 0.3s;
}

:deep(.search-btn:hover, .clear-btn:hover) {
  background-color: #337ECC;
}

:deep(.clear-btn) {
  background-color: #F56C6C;
  border-color: #F56C6C;
}

:deep(.clear-btn:hover) {
  background-color: #DD6161;
}

/* æ•°å€¼è¾“å…¥æ¡† - å‚ç›´å¸ƒå±€ */
:deep(.number-input--wrapper) {
  display: flex;
  flex-direction: column;
  gap: 8px;
  border: 1px solid #E4E7ED;
  border-radius: 6px;
  padding: 12px;
  background-color: #F9FAFC;
  width: 40%;

}

:deep(.number-input--main) {
  width: 100%;
}

:deep(.number-input--extra) {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

:deep(.number-controls) {
  display: flex;
  gap: 8px;
  align-items: center;
  justify-content: center;
}

:deep(.number-controls button) {
  padding: 6px 12px;
  border: 1px solid #67C23A;
  border-radius: 4px;
  background-color: #67C23A;
  color: white;
  cursor: pointer;
  font-size: 14px;
  transition: all 0.3s;
}

:deep(.number-controls button:hover) {
  background-color: #5DAE34;
}

:deep(.number-info) {
  font-size: 12px;
  color: #909399;
  font-weight: 500;
}

</style>